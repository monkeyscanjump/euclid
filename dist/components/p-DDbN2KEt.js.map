{"file":"p-DDbN2KEt.js","mappings":"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","names":["__stencil_proxyCustomElement","HTMLElement"],"sources":["src/components/core/euclid-swap-controller/euclid-swap-controller.tsx"],"sourcesContent":["import { Component, Listen, State, Watch } from '@stencil/core';\nimport { swapStore } from '../../../store/swap.store';\nimport { walletStore } from '../../../store/wallet.store';\nimport { apiClient } from '../../../utils/api-client';\nimport { WalletAdapterFactory } from '../../../utils/wallet-adapter';\nimport { DEFAULTS } from '../../../utils/constants';\nimport { EUCLID_EVENTS, dispatchEuclidEvent } from '../../../utils/events';\n\n@Component({\n  tag: 'euclid-swap-controller',\n})\nexport class EuclidSwapController {\n  @State() isInitialized = false;\n  private routePollingInterval: number;\n  private routePollingActive = false;\n\n  async componentDidLoad() {\n    await this.initialize();\n  }\n\n  disconnectedCallback() {\n    this.stopRoutePolling();\n  }\n\n  private async initialize() {\n    console.log('üîÑ Initializing Swap Controller...');\n\n    // Subscribe to swap store changes for smart polling\n    swapStore.onChange('fromToken', () => this.handleTokenChange());\n    swapStore.onChange('toToken', () => this.handleTokenChange());\n    swapStore.onChange('fromAmount', () => this.handleAmountChange());\n\n    this.isInitialized = true;\n    console.log('‚úÖ Swap Controller initialized');\n  }\n\n  private handleTokenChange() {\n    // Clear existing routes when tokens change\n    swapStore.setRoutes([]);\n    swapStore.setSelectedRoute(undefined);\n    this.stopRoutePolling();\n\n    // Start polling if we have both tokens and an amount\n    if (swapStore.state.fromToken && swapStore.state.toToken && swapStore.state.fromAmount) {\n      this.startRoutePolling();\n    }\n  }\n\n  private handleAmountChange() {\n    const { fromToken, toToken, fromAmount } = swapStore.state;\n\n    if (fromToken && toToken && fromAmount && parseFloat(fromAmount) > 0) {\n      // Debounce the route fetching\n      this.debounceRouteFetch();\n    } else {\n      this.stopRoutePolling();\n      swapStore.setRoutes([]);\n    }\n  }\n\n  private debounceTimeout: number;\n\n  private debounceRouteFetch() {\n    if (this.debounceTimeout) {\n      clearTimeout(this.debounceTimeout);\n    }\n\n    this.debounceTimeout = window.setTimeout(() => {\n      this.startRoutePolling();\n    }, 500); // 500ms debounce\n  }\n\n  private startRoutePolling() {\n    if (this.routePollingActive) return;\n\n    console.log('üîÑ Starting route polling...');\n    this.routePollingActive = true;\n\n    // Fetch routes immediately\n    this.fetchRoutes();\n\n    // Set up periodic polling\n    this.routePollingInterval = window.setInterval(() => {\n      this.fetchRoutes();\n    }, DEFAULTS.ROUTE_REFRESH_INTERVAL);\n  }\n\n  private stopRoutePolling() {\n    if (!this.routePollingActive) return;\n\n    console.log('‚èπÔ∏è Stopping route polling...');\n    this.routePollingActive = false;\n\n    if (this.routePollingInterval) {\n      clearInterval(this.routePollingInterval);\n    }\n  }\n\n  private async fetchRoutes() {\n    const { fromToken, toToken, fromAmount } = swapStore.state;\n\n    if (!fromToken || !toToken || !fromAmount || parseFloat(fromAmount) <= 0) {\n      return;\n    }\n\n    try {\n      swapStore.setLoadingRoutes(true);\n\n      console.log('üõ£Ô∏è Fetching swap routes:', {\n        from: fromToken.symbol,\n        to: toToken.symbol,\n        amount: fromAmount,\n      });\n\n      // Call the routes API\n      const response = await apiClient.getRoutesWrapped({\n        amount_in: fromAmount,\n        token_in: fromToken.id,\n        token_out: toToken.id,\n        external: true,\n      });\n\n      if (response.success && response.data) {\n        const routePaths = response.data.paths || [];\n\n        // Store the RoutePath[] directly\n        swapStore.setRoutes(routePaths);\n\n        // Auto-select the best route (first one, typically best by default)\n        if (routePaths.length > 0 && !swapStore.state.selectedRoute) {\n          swapStore.setSelectedRoute(routePaths[0]);\n        }\n\n        console.log(`‚úÖ Found ${routePaths.length} swap routes`);\n      } else {\n        console.warn('‚ö†Ô∏è Failed to fetch routes:', response.error);\n        swapStore.setRoutes([]);\n      }\n    } catch (error) {\n      console.error('‚ùå Error fetching routes:', error);\n      swapStore.setRoutes([]);\n    } finally {\n      swapStore.setLoadingRoutes(false);\n    }\n  }\n\n  private getUserAddressForChain(chainUID: string): string | undefined {\n    const wallet = walletStore.getWallet(chainUID);\n    return wallet?.address;\n  }\n\n  // Execute swap transaction\n  async executeSwap(): Promise<{ success: boolean; txHash?: string; error?: string }> {\n    try {\n      const { fromToken, toToken, fromAmount, selectedRoute, slippage } = swapStore.state;\n\n      if (!fromToken || !toToken || !fromAmount || !selectedRoute) {\n        return { success: false, error: 'Missing required swap parameters' };\n      }\n\n      // Check if wallet is connected for the required chain\n      const wallet = walletStore.getWallet(fromToken.chainUID);\n      if (!wallet?.isConnected) {\n        return { success: false, error: `Wallet not connected for ${fromToken.chainUID}` };\n      }\n\n      // Check sufficient balance\n      if (!walletStore.hasSufficientBalance(fromToken.chainUID, fromToken.id, fromAmount)) {\n        return { success: false, error: 'Insufficient balance' };\n      }\n\n      swapStore.setSwapping(true);\n\n      console.log('üîÑ Executing swap...', {\n        from: fromToken.symbol,\n        to: toToken.symbol,\n        amount: fromAmount,\n        route: selectedRoute.id,\n      });\n\n      // Get the wallet adapter for signing\n      const walletAdapter = WalletAdapterFactory.getAdapter(wallet.type);\n      if (!walletAdapter) {\n        return { success: false, error: `Wallet adapter not found for ${wallet.type}` };\n      }\n\n      // Execute the swap via API - create a basic SwapRequest structure\n      const swapResult = await apiClient.createSwapTransactionWrapped({\n        amount_in: fromAmount,\n        asset_in: {\n          token: fromToken.id,\n          token_type: { native: { denom: fromToken.id } }\n        },\n        slippage: slippage.toString(),\n        minimum_receive: this.calculateMinimumReceived(selectedRoute.outputAmount, slippage),\n        sender: {\n          address: wallet.address,\n          chain_uid: fromToken.chain_uid || fromToken.chainUID\n        },\n        swap_path: {\n          path: selectedRoute.path || []\n        },\n        timeout: (Math.floor(Date.now() / 1000) + 1200).toString() // 20 minutes from now\n      });\n\n      if (swapResult.success && swapResult.data) {\n        const txHash = `swap_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n        // Add transaction to wallet store\n        walletStore.addTransaction(fromToken.chainUID, {\n          txHash,\n          timestamp: Date.now(),\n          type: 'swap'\n        });\n\n        // Emit global event for transaction tracking\n        dispatchEuclidEvent(EUCLID_EVENTS.TRANSACTION.SUBMITTED, {\n          txHash,\n          chainUID: fromToken.chainUID,\n          type: 'swap',\n        });\n\n        console.log('‚úÖ Swap transaction submitted:', txHash);\n        return { success: true, txHash };\n      } else {\n        return { success: false, error: swapResult.error || 'Swap execution failed' };\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred';\n      console.error('‚ùå Swap execution error:', errorMessage);\n      return { success: false, error: errorMessage };\n    } finally {\n      swapStore.setSwapping(false);\n    }\n  }\n\n  private calculateMinimumReceived(outputAmount: string, slippage: number): string {\n    try {\n      const amount = BigInt(outputAmount);\n      const slippageMultiplier = BigInt(Math.floor((100 - slippage) * 100)); // Convert to basis points\n      const minimumReceived = (amount * slippageMultiplier) / BigInt(10000);\n      return minimumReceived.toString();\n    } catch {\n      return outputAmount; // Fallback to original amount\n    }\n  }\n\n  // Event listeners\n  @Listen(EUCLID_EVENTS.SWAP.EXECUTE_REQUEST, { target: 'window' })\n  async handleSwapExecution() {\n    console.log('üîÑ Swap execution requested via event');\n    const result = await this.executeSwap();\n\n    // Emit result event\n    if (result.success) {\n      dispatchEuclidEvent(EUCLID_EVENTS.SWAP.EXECUTE_SUCCESS, {\n        txHash: result.txHash,\n      });\n    } else {\n      dispatchEuclidEvent(EUCLID_EVENTS.SWAP.EXECUTE_FAILED, {\n        error: result.error,\n      });\n    }\n  }\n\n  @Listen(EUCLID_EVENTS.SWAP.ROUTES_REFRESH, { target: 'window' })\n  handleRouteRefresh() {\n    console.log('üîÑ Manual route refresh requested');\n    this.fetchRoutes();\n  }\n\n  @Listen(EUCLID_EVENTS.SWAP.ROUTES_STOP_POLLING, { target: 'window' })\n  handleStopPolling() {\n    this.stopRoutePolling();\n  }\n\n  @Listen(EUCLID_EVENTS.SWAP.ROUTES_START_POLLING, { target: 'window' })\n  handleStartPolling() {\n    this.startRoutePolling();\n  }\n\n  @Watch('isInitialized')\n  onInitializedChange(newValue: boolean) {\n    if (newValue) {\n      console.log('üìä Swap Controller ready for route polling');\n    }\n  }\n\n  render() {\n    // This is a headless controller - no visual output\n    return null;\n  }\n}\n"],"version":3}