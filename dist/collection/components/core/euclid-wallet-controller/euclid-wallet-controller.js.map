{"version":3,"file":"euclid-wallet-controller.js","sourceRoot":"","sources":["../../../../src/components/core/euclid-wallet-controller/euclid-wallet-controller.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAK,KAAK,EAAE,MAAM,EAAE,MAAM,eAAe,CAAC;AAC5D,OAAO,EAAE,WAAW,EAAE,MAAM,6BAA6B,CAAC;AAC1D,OAAO,EAAE,WAAW,EAAE,MAAM,6BAA6B,CAAC;AAC1D,OAAO,EAAE,oBAAoB,EAAE,MAAM,+BAA+B,CAAC;AACrE,OAAO,EAAE,aAAa,EAAE,mBAAmB,EAAE,MAAM,uBAAuB,CAAC;AAK3E,MAAM,OAAO,sBAAsB;IAHnC;QAIW,kBAAa,GAAG,KAAK,CAAC;KAyKhC;IAvKC,KAAK,CAAC,gBAAgB;QACpB,MAAM,IAAI,CAAC,UAAU,EAAE,CAAC;IAC1B,CAAC;IAEO,KAAK,CAAC,UAAU;QACtB,OAAO,CAAC,GAAG,CAAC,sCAAsC,CAAC,CAAC;QAEpD,2CAA2C;QAC3C,MAAM,IAAI,CAAC,sBAAsB,EAAE,CAAC;QAEpC,gCAAgC;QAChC,IAAI,CAAC,yBAAyB,EAAE,CAAC;QAEjC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC1B,OAAO,CAAC,GAAG,CAAC,iCAAiC,CAAC,CAAC;IACjD,CAAC;IAEO,KAAK,CAAC,sBAAsB;QAClC,MAAM,gBAAgB,GAAG,EAAE,CAAC;QAE5B,mCAAmC;QACnC,IAAI,MAAM,CAAC,KAAK,EAAE,CAAC;YACjB,gBAAgB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACjC,CAAC;QAED,mCAAmC;QACnC,IAAI,MAAM,CAAC,QAAQ,EAAE,UAAU,EAAE,CAAC;YAChC,gBAAgB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACpC,CAAC;QAED,yBAAyB;QACzB,IAAI,MAAM,CAAC,YAAY,EAAE,CAAC;YACxB,gBAAgB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QACxC,CAAC;QAED,OAAO,CAAC,GAAG,CAAC,gCAAgC,EAAE,gBAAgB,CAAC,CAAC;QAChE,OAAO,gBAAgB,CAAC;IAC1B,CAAC;IAEO,yBAAyB;QAC/B,sCAAsC;QACtC,IAAI,MAAM,CAAC,QAAQ,EAAE,CAAC;YACpB,oFAAoF;YACpF,MAAM,WAAW,GAAG,MAAM,CAAC,QAE1B,CAAC;YAEF,IAAI,WAAW,CAAC,EAAE,EAAE,CAAC;gBACnB,WAAW,CAAC,EAAE,CAAC,iBAAiB,EAAE,CAAC,QAAkB,EAAE,EAAE;oBACvD,OAAO,CAAC,GAAG,CAAC,4BAA4B,EAAE,QAAQ,CAAC,CAAC;oBACpD,IAAI,CAAC,sBAAsB,CAAC,QAAQ,CAAC,CAAC;gBACxC,CAAC,CAAC,CAAC;gBAEH,WAAW,CAAC,EAAE,CAAC,cAAc,EAAE,CAAC,OAAe,EAAE,EAAE;oBACjD,OAAO,CAAC,GAAG,CAAC,yBAAyB,EAAE,OAAO,CAAC,CAAC;oBAChD,IAAI,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;gBACrC,CAAC,CAAC,CAAC;YACL,CAAC;QACH,CAAC;QAED,0BAA0B;QAC1B,MAAM,CAAC,gBAAgB,CAAC,sBAAsB,EAAE,GAAG,EAAE;YACnD,OAAO,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC;YACtC,IAAI,CAAC,yBAAyB,EAAE,CAAC;QACnC,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,KAAK,CAAC,sBAAsB,CAAC,QAAkB;QACrD,IAAI,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YAC1B,oBAAoB;YACpB,IAAI,CAAC,oBAAoB,EAAE,CAAC;QAC9B,CAAC;aAAM,CAAC;YACN,gCAAgC;YAChC,sDAAsD;QACxD,CAAC;IACH,CAAC;IAEO,oBAAoB,CAAC,OAAe;QAC1C,2BAA2B;QAC3B,OAAO,CAAC,GAAG,CAAC,mBAAmB,EAAE,OAAO,CAAC,CAAC;QAC1C,gDAAgD;IAClD,CAAC;IAEO,yBAAyB;QAC/B,yDAAyD;QACzD,wCAAwC;IAC1C,CAAC;IAEO,oBAAoB;QAC1B,6BAA6B;QAC7B,MAAM,SAAS,GAAG,CAAC,UAAU,EAAE,KAAK,EAAE,SAAS,EAAE,UAAU,EAAE,MAAM,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC;QACzF,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;YAC3B,WAAW,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;IACL,CAAC;IAGD,KAAK,CAAC,6BAA6B,CAAC,KAA4D;QAC9F,MAAM,EAAE,QAAQ,EAAE,UAAU,EAAE,GAAG,KAAK,CAAC,MAAM,CAAC;QAC9C,OAAO,CAAC,GAAG,CAAC,iCAAiC,EAAE,EAAE,QAAQ,EAAE,UAAU,EAAE,CAAC,CAAC;QAEzE,IAAI,CAAC;YACH,MAAM,IAAI,CAAC,aAAa,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC;QACjD,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,2BAA2B,EAAE,KAAK,CAAC,CAAC;YAClD,gCAAgC;YAChC,mBAAmB,CAAC,aAAa,CAAC,MAAM,CAAC,cAAc,EAAE;gBACvD,QAAQ;gBACR,UAAU;gBACV,KAAK,EAAE,KAAK,CAAC,OAAO;aACrB,CAAC,CAAC;QACL,CAAC;IACH,CAAC;IAGD,gCAAgC,CAAC,KAAwC;QACvE,MAAM,EAAE,QAAQ,EAAE,GAAG,KAAK,CAAC,MAAM,CAAC;QAClC,OAAO,CAAC,GAAG,CAAC,oCAAoC,EAAE,QAAQ,CAAC,CAAC;QAE5D,WAAW,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;QAEvC,mCAAmC;QACnC,mBAAmB,CAAC,aAAa,CAAC,MAAM,CAAC,kBAAkB,EAAE,EAAE,QAAQ,EAAE,CAAC,CAAC;IAC7E,CAAC;IAEO,KAAK,CAAC,aAAa,CAAC,QAAgB,EAAE,UAAkB;QAC9D,0BAA0B;QAC1B,MAAM,WAAW,GAAG,WAAW,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACnD,IAAI,CAAC,WAAW,EAAE,CAAC;YACjB,MAAM,IAAI,KAAK,CAAC,qCAAqC,QAAQ,EAAE,CAAC,CAAC;QACnE,CAAC;QAED,uBAAuB;QACvB,MAAM,gBAAgB,GAAG,CAAC,OAAO,EAAE,UAAU,EAAE,cAAc,EAAE,eAAe,CAAC,CAAC;QAChF,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE,CAAC;YAC3C,MAAM,IAAI,KAAK,CAAC,4BAA4B,UAAU,EAAE,CAAC,CAAC;QAC5D,CAAC;QAED,mEAAmE;QACnE,MAAM,MAAM,GAAG,MAAM,oBAAoB,CAAC,aAAa,CAAC,UAAqE,EAAE,WAAW,CAAC,CAAC;QAE5I,IAAI,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,OAAO,EAAE,CAAC;YACrC,sBAAsB;YACtB,WAAW,CAAC,SAAS,CAAC,QAAQ,EAAE;gBAC9B,OAAO,EAAE,MAAM,CAAC,OAAO;gBACvB,IAAI,EAAE,UAAU;gBAChB,UAAU,EAAE,UAA8C;gBAC1D,IAAI,EAAE,UAA8C,EAAE,eAAe;gBACrE,WAAW,EAAE,IAAI;gBACjB,QAAQ,EAAE,EAAE;aACb,CAAC,CAAC;YAEH,gCAAgC;YAChC,mBAAmB,CAAC,aAAa,CAAC,MAAM,CAAC,eAAe,EAAE;gBACxD,QAAQ;gBACR,UAAU;gBACV,OAAO,EAAE,MAAM,CAAC,OAAO;aACxB,CAAC,CAAC;QACL,CAAC;aAAM,CAAC;YACN,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,IAAI,0BAA0B,CAAC,CAAC;QAC9D,CAAC;IACH,CAAC;IAED,MAAM;QACJ,mDAAmD;QACnD,OAAO,IAAI,CAAC;IACd,CAAC;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["import { Component, h, State, Listen } from '@stencil/core';\nimport { walletStore } from '../../../store/wallet.store';\nimport { marketStore } from '../../../store/market.store';\nimport { WalletAdapterFactory } from '../../../utils/wallet-adapter';\nimport { EUCLID_EVENTS, dispatchEuclidEvent } from '../../../utils/events';\n\n@Component({\n  tag: 'euclid-wallet-controller',\n})\nexport class EuclidWalletController {\n  @State() isInitialized = false;\n\n  async componentDidLoad() {\n    await this.initialize();\n  }\n\n  private async initialize() {\n    console.log('ðŸ”— Initializing Wallet Controller...');\n\n    // Check for available wallets on page load\n    await this.detectAvailableWallets();\n\n    // Set up wallet event listeners\n    this.setupWalletEventListeners();\n\n    this.isInitialized = true;\n    console.log('âœ… Wallet Controller initialized');\n  }\n\n  private async detectAvailableWallets() {\n    const availableWallets = [];\n\n    // Check for Keplr (Cosmos wallets)\n    if (window.keplr) {\n      availableWallets.push('keplr');\n    }\n\n    // Check for MetaMask (EVM wallets)\n    if (window.ethereum?.isMetaMask) {\n      availableWallets.push('metamask');\n    }\n\n    // Check for Cosmostation\n    if (window.cosmostation) {\n      availableWallets.push('cosmostation');\n    }\n\n    console.log('ðŸ” Available wallets detected:', availableWallets);\n    return availableWallets;\n  }\n\n  private setupWalletEventListeners() {\n    // Listen for MetaMask account changes\n    if (window.ethereum) {\n      // MetaMask's ethereum object has event emitter methods not defined in our interface\n      const ethProvider = window.ethereum as typeof window.ethereum & {\n        on?: (event: string, callback: (...args: unknown[]) => void) => void;\n      };\n\n      if (ethProvider.on) {\n        ethProvider.on('accountsChanged', (accounts: string[]) => {\n          console.log('MetaMask accounts changed:', accounts);\n          this.handleEvmAccountChange(accounts);\n        });\n\n        ethProvider.on('chainChanged', (chainId: string) => {\n          console.log('MetaMask chain changed:', chainId);\n          this.handleEvmChainChange(chainId);\n        });\n      }\n    }\n\n    // Listen for Keplr events\n    window.addEventListener('keplr_keystorechange', () => {\n      console.log('Keplr keystore changed');\n      this.handleKeplrKeystoreChange();\n    });\n  }\n\n  private async handleEvmAccountChange(accounts: string[]) {\n    if (accounts.length === 0) {\n      // User disconnected\n      this.disconnectEvmWallets();\n    } else {\n      // Update connected EVM accounts\n      // TODO: Update all EVM chain wallets with new account\n    }\n  }\n\n  private handleEvmChainChange(chainId: string) {\n    // Handle EVM chain changes\n    console.log('Chain changed to:', chainId);\n    // TODO: Update wallet store with new chain info\n  }\n\n  private handleKeplrKeystoreChange() {\n    // Handle Keplr keystore changes (account switches, etc.)\n    // TODO: Update all Cosmos chain wallets\n  }\n\n  private disconnectEvmWallets() {\n    // Disconnect all EVM wallets\n    const evmChains = ['ethereum', 'bsc', 'polygon', 'arbitrum', 'base', 'manta', 'sepolia'];\n    evmChains.forEach(chainUID => {\n      walletStore.removeWallet(chainUID);\n    });\n  }\n\n  @Listen(EUCLID_EVENTS.WALLET.CONNECT_REQUEST, { target: 'window' })\n  async handleWalletConnectionRequest(event: CustomEvent<{ chainUID: string; walletType: string }>) {\n    const { chainUID, walletType } = event.detail;\n    console.log('ðŸ”— Wallet connection requested:', { chainUID, walletType });\n\n    try {\n      await this.connectWallet(chainUID, walletType);\n    } catch (error) {\n      console.error('Failed to connect wallet:', error);\n      // Emit connection failure event\n      dispatchEuclidEvent(EUCLID_EVENTS.WALLET.CONNECT_FAILED, {\n        chainUID,\n        walletType,\n        error: error.message\n      });\n    }\n  }\n\n  @Listen(EUCLID_EVENTS.WALLET.DISCONNECT_REQUEST, { target: 'window' })\n  handleWalletDisconnectionRequest(event: CustomEvent<{ chainUID: string }>) {\n    const { chainUID } = event.detail;\n    console.log('ðŸ”Œ Wallet disconnection requested:', chainUID);\n\n    walletStore.disconnectWallet(chainUID);\n\n    // Emit disconnection success event\n    dispatchEuclidEvent(EUCLID_EVENTS.WALLET.DISCONNECT_SUCCESS, { chainUID });\n  }\n\n  private async connectWallet(chainUID: string, walletType: string) {\n    // Get chain configuration\n    const chainConfig = marketStore.getChain(chainUID);\n    if (!chainConfig) {\n      throw new Error(`Chain configuration not found for ${chainUID}`);\n    }\n\n    // Validate wallet type\n    const validWalletTypes = ['keplr', 'metamask', 'cosmostation', 'walletconnect'];\n    if (!validWalletTypes.includes(walletType)) {\n      throw new Error(`Unsupported wallet type: ${walletType}`);\n    }\n\n    // Use the wallet adapter factory for proper separation of concerns\n    const result = await WalletAdapterFactory.connectWallet(walletType as 'keplr' | 'metamask' | 'cosmostation' | 'walletconnect', chainConfig);\n\n    if (result.success && result.address) {\n      // Add wallet to store\n      walletStore.addWallet(chainUID, {\n        address: result.address,\n        name: walletType,\n        walletType: walletType as 'keplr' | 'metamask' | 'phantom',\n        type: walletType as 'keplr' | 'metamask' | 'phantom', // legacy alias\n        isConnected: true,\n        balances: []\n      });\n\n      // Emit connection success event\n      dispatchEuclidEvent(EUCLID_EVENTS.WALLET.CONNECT_SUCCESS, {\n        chainUID,\n        walletType,\n        address: result.address\n      });\n    } else {\n      throw new Error(result.error || 'Failed to connect wallet');\n    }\n  }\n\n  render() {\n    // This is a headless controller - no visual output\n    return null;\n  }\n}\n"]}