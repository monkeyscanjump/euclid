<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simple Component Test</title>
  <script type="module" src="/build/euclid.esm.js"></script>
  <script nomodule src="/build/euclid.js"></script>
  <link rel="stylesheet" href="/build/euclid.css" />

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
      background: #f5f5f5;
    }

    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .test-section h3 {
      margin-top: 0;
      color: #333;
    }

    .status {
      padding: 8px 12px;
      border-radius: 4px;
      margin: 10px 0;
      font-weight: bold;
    }

    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }

    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }

    button:hover {
      background: #0056b3;
    }

    #error-log {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 4px;
      padding: 15px;
      margin: 20px 0;
      font-family: monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>

<body>
  <h1>üß™ Euclid Protocol - Simple Component Test</h1>
  <p>Testing individual components step by step.</p>

  <div class="test-section">
    <h3>1. Basic Button Test</h3>
    <p>Testing if the euclid-button component loads and works:</p>
    <div id="button-test">
      <div class="status info">Click "Test Button" to see if it works</div>
    </div>
    <button onclick="testButton()">Test Button</button>
  </div>

  <div class="test-section">
    <h3>2. Core Provider Test</h3>
    <p>Testing if the core provider initializes without errors:</p>
    <div id="core-test">
      <div class="status info">Click "Test Core Provider" to initialize</div>
    </div>
    <button onclick="testCoreProvider()">Test Core Provider</button>
  </div>

  <div class="test-section">
    <h3>3. Token Input Test</h3>
    <p>Testing the token input component:</p>
    <div id="token-input-test">
      <div class="status info">Click "Test Token Input" to add one</div>
    </div>
    <button onclick="testTokenInput()">Test Token Input</button>
  </div>

  <div class="test-section">
    <h3>üêõ Error Log</h3>
    <div id="error-log">No errors yet...</div>
  </div>

  <script>
    let errorCount = 0;

    function logError(message, error = null) {
      errorCount++;
      const errorLog = document.getElementById('error-log');
      const timestamp = new Date().toLocaleTimeString();
      errorLog.innerHTML += `<div style="margin: 5px 0; padding: 5px; background: #ffebee; border-left: 3px solid #f44336;">[${timestamp}] ${message}${error ? ': ' + error.toString() : ''}</div>`;
      console.error(message, error);
    }

    function updateStatus(testId, message, success = true) {
      const testDiv = document.getElementById(testId);
      const statusDiv = testDiv.querySelector('.status');
      statusDiv.textContent = message;
      statusDiv.className = `status ${success ? 'success' : 'error'}`;
    }

    function testButton() {
      try {
        updateStatus('button-test', 'Creating button component...', true);

        // Create a button element
        const button = document.createElement('euclid-button');
        button.textContent = 'I am a Euclid Button!';
        button.variant = 'primary';

        // Add it to the test area
        const testDiv = document.getElementById('button-test');
        testDiv.appendChild(button);

        // Test if we can modify its properties
        setTimeout(() => {
          try {
            button.loading = true;
            updateStatus('button-test', '‚úÖ Button created and loading state works!', true);

            setTimeout(() => {
              button.loading = false;
              button.variant = 'secondary';
              updateStatus('button-test', '‚úÖ Button fully functional! Properties work correctly.', true);
            }, 1500);
          } catch (e) {
            logError('Button property test failed', e);
            updateStatus('button-test', '‚ùå Button properties failed', false);
          }
        }, 100);

      } catch (error) {
        logError('Button test failed', error);
        updateStatus('button-test', '‚ùå Button test failed: ' + error.message, false);
      }
    }

    function testCoreProvider() {
      try {
        updateStatus('core-test', 'Creating core provider...', true);

        // Create core provider element
        const coreProvider = document.createElement('euclid-core-provider');
        coreProvider.innerHTML = '<p style="padding: 15px; background: #e8f5e8; border-radius: 4px; margin: 10px 0;">Core Provider is running! üöÄ</p>';

        // Add it to the test area
        const testDiv = document.getElementById('core-test');
        testDiv.appendChild(coreProvider);

        updateStatus('core-test', '‚úÖ Core provider created successfully!', true);

      } catch (error) {
        logError('Core provider test failed', error);
        updateStatus('core-test', '‚ùå Core provider failed: ' + error.message, false);
      }
    }

    function testTokenInput() {
      try {
        updateStatus('token-input-test', 'Creating token input...', true);

        // Create token input element
        const tokenInput = document.createElement('euclid-token-input');
        tokenInput.placeholder = 'Enter amount...';
        tokenInput.value = '100.50';

        // Add it to the test area
        const testDiv = document.getElementById('token-input-test');
        testDiv.appendChild(tokenInput);

        // Test setting token info
        setTimeout(() => {
          try {
            const tokenInfo = {
              id: 'usdc',
              symbol: 'USDC',
              name: 'USD Coin',
              decimals: 6,
              chainUID: 'ethereum',
              logo: '/assets/usdc.png'
            };
            tokenInput.token = tokenInfo;
            updateStatus('token-input-test', '‚úÖ Token input created and configured!', true);
          } catch (e) {
            logError('Token input configuration failed', e);
            updateStatus('token-input-test', '‚ùå Token input config failed', false);
          }
        }, 100);

      } catch (error) {
        logError('Token input test failed', error);
        updateStatus('token-input-test', '‚ùå Token input failed: ' + error.message, false);
      }
    }

    // Global error handling
    window.addEventListener('error', (e) => {
      logError('Global JavaScript Error', e.error);
    });

    window.addEventListener('unhandledrejection', (e) => {
      logError('Unhandled Promise Rejection', e.reason);
    });

    // Check if components are registered when page loads
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üîç Checking component registration...');

      const components = ['euclid-button', 'euclid-core-provider', 'euclid-token-input'];
      components.forEach(tag => {
        const isRegistered = customElements.get(tag);
        console.log(`${isRegistered ? '‚úÖ' : '‚ùå'} ${tag}: ${isRegistered ? 'registered' : 'NOT registered'}`);
      });
    });
  </script>
</body>
</html>
