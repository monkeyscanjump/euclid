var l=class{constructor(){this.processedData=[];this.originalData=[];this.currentDataType="tokens";this.currentFilters={search:"",sortBy:"",sortOrder:"asc"};self.addEventListener("message",this.handleMessage.bind(this))}handleMessage(a){let{id:e,type:r,payload:t}=a.data,s=performance.now();try{switch(r){case"PROCESS_DATA":this.processData(e,t,s);break;case"GET_BATCH":this.getBatch(e,t,s);break;case"SEARCH":this.performSearch(e,t,s);break;case"SORT":this.performSort(e,t,s);break;default:this.sendError(e,`Unknown message type: ${r}`)}}catch(n){this.sendError(e,n instanceof Error?n.message:"Unknown error")}}processData(a,e,r){let{data:t,dataType:s,filterState:n}=e;if(!t||!s||!n){this.sendError(a,"Missing required data for processing");return}this.originalData=t,this.currentDataType=s,this.currentFilters=n;let o=[...this.originalData];n.search&&(o=this.applySearch(o,n.search)),o=this.applyTypeSpecificFilters(o,n),n.sortBy&&(o=this.applySorting(o,n)),this.processedData=o;let i=performance.now()-r;this.sendResponse(a,"PROCESSED_DATA",{filteredData:o,totalCount:o.length,processingTime:i})}getBatch(a,e,r){let{batchSize:t=20,startIndex:s=0}=e,n=this.processedData.slice(s,s+t),o=s+t<this.processedData.length,i=performance.now()-r;this.sendResponse(a,"BATCH_DATA",{batchData:n,totalCount:this.processedData.length,hasMore:o,processingTime:i})}performSearch(a,e,r){let{filterState:t}=e;if(!(t!=null&&t.search)){this.sendError(a,"Search query is required");return}let s=this.applySearch([...this.originalData],t.search),n=performance.now()-r;this.sendResponse(a,"SEARCH_RESULTS",{filteredData:s,totalCount:s.length,processingTime:n})}performSort(a,e,r){let{filterState:t}=e;if(!(t!=null&&t.sortBy)){this.sendError(a,"Sort field is required");return}let s=this.applySorting([...this.processedData],t),n=performance.now()-r;this.sendResponse(a,"SORT_RESULTS",{filteredData:s,totalCount:s.length,processingTime:n})}applySearch(a,e){let r=e.toLowerCase(),t=this.getSearchFields();return a.filter(s=>t.some(n=>{let o=this.getItemValue(s,n);return o&&o.toString().toLowerCase().includes(r)}))}getSearchFields(){switch(this.currentDataType){case"tokens":return["displayName","tokenId","name"];case"chains":return["display_name","chain_id","chain_uid"];case"pools":return["token_1","token_2","pool_id"];default:return["name"]}}applyTypeSpecificFilters(a,e){switch(this.currentDataType){case"tokens":return this.applyTokenFilters(a,e);case"chains":return this.applyChainFilters(a,e);case"pools":return this.applyPoolFilters(a,e);default:return a}}applyTokenFilters(a,e){let r=[...a];return e.chainFilter&&(r=r.filter(t=>{var s;return(s=t.chain_uids)==null?void 0:s.includes(e.chainFilter)})),e.showFavorites,r}applyChainFilters(a,e){let r=[...a];return e.typeFilter&&(r=r.filter(t=>t.type===e.typeFilter)),r}applyPoolFilters(a,e){let r=[...a];return e.showMyPools,r}applySorting(a,e){return[...a].sort((r,t)=>{let s,n;switch(this.currentDataType){case"tokens":({aValue:s,bValue:n}=this.getTokenSortValues(r,t,e.sortBy));break;case"chains":({aValue:s,bValue:n}=this.getChainSortValues(r,t,e.sortBy));break;case"pools":({aValue:s,bValue:n}=this.getPoolSortValues(r,t,e.sortBy));break;default:s=n=0}if(typeof s=="string"&&typeof n=="string"){let i=s.localeCompare(n);return e.sortOrder==="asc"?i:-i}let o=(s||0)-(n||0);return e.sortOrder==="asc"?o:-o})}getTokenSortValues(a,e,r){switch(r){case"name":return{aValue:a.displayName,bValue:e.displayName};case"price":return{aValue:parseFloat(a.price||"0"),bValue:parseFloat(e.price||"0")};case"volume":return{aValue:a.total_volume_24h||0,bValue:e.total_volume_24h||0};case"marketCap":return{aValue:0,bValue:0};default:return{aValue:a.displayName,bValue:e.displayName}}}getChainSortValues(a,e,r){switch(r){case"name":return{aValue:a.display_name,bValue:e.display_name};case"type":return{aValue:a.type,bValue:e.type};case"chain_id":return{aValue:a.chain_id,bValue:e.chain_id};default:return{aValue:a.display_name,bValue:e.display_name}}}getPoolSortValues(a,e,r){var t,s;switch(r){case"apr":return{aValue:parseFloat(((t=a.apr)==null?void 0:t.replace("%",""))||"0"),bValue:parseFloat(((s=e.apr)==null?void 0:s.replace("%",""))||"0")};case"tvl":return{aValue:parseFloat(a.total_liquidity||"0"),bValue:parseFloat(e.total_liquidity||"0")};case"volume":return{aValue:parseFloat(a.volume_24h||"0"),bValue:parseFloat(e.volume_24h||"0")};case"fees":return{aValue:parseFloat(a.fees_24h||"0"),bValue:parseFloat(e.fees_24h||"0")};default:return{aValue:a.token_1,bValue:e.token_1}}}getItemValue(a,e){let r=e.split("."),t=a;for(let s of r)if(t&&typeof t=="object"&&s in t)t=t[s];else return null;return t}sendResponse(a,e,r){let t={id:a,type:e,payload:r};self.postMessage(t)}sendError(a,e){let r={id:a,type:"ERROR",payload:{error:e}};self.postMessage(r)}};new l;
