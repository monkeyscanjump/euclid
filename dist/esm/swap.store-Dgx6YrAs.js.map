{"version":3,"file":"swap.store-Dgx6YrAs.js","sources":["src/store/swap.store.ts"],"sourcesContent":["import { createStore } from '@stencil/store';\nimport type { SwapState } from '../utils/types/euclid-api.types';\nimport type { TokenMetadata, RoutePath } from '../utils/types/api.types';\nimport type { BaseStore } from './types';\n\nconst initialState: SwapState = {\n  tokenIn: null,\n  tokenOut: null,\n  fromToken: null, // alias for backward compatibility\n  toToken: null,   // alias for backward compatibility\n  amountIn: '',\n  amountOut: '',\n  fromAmount: '', // alias for backward compatibility\n  toAmount: '',   // alias for backward compatibility\n  routes: [],\n  selectedRoute: null,\n  slippage: 0.5, // 0.5% default\n  loading: false,\n  error: null,\n};\n\nconst { state, onChange, reset, dispose } = createStore(initialState);\n\n// Actions\nconst actions = {\n  setTokenIn(token: TokenMetadata | null) {\n    state.tokenIn = token;\n    state.fromToken = token; // Keep aliases synchronized\n    // Clear routes when changing tokens\n    state.routes = [];\n    state.selectedRoute = null;\n    state.amountOut = '';\n    state.toAmount = '';\n  },\n\n  setTokenOut(token: TokenMetadata | null) {\n    state.tokenOut = token;\n    state.toToken = token; // Keep aliases synchronized\n    // Clear routes when changing tokens\n    state.routes = [];\n    state.selectedRoute = null;\n    state.amountOut = '';\n    state.toAmount = '';\n  },\n\n  // Backward compatibility aliases\n  setFromToken(token: TokenMetadata | null) {\n    actions.setTokenIn(token);\n  },\n\n  setToToken(token: TokenMetadata | null) {\n    actions.setTokenOut(token);\n  },\n\n  setAmountIn(amount: string) {\n    state.amountIn = amount;\n    state.fromAmount = amount; // Keep aliases synchronized\n    // Clear output when changing input\n    if (!amount) {\n      state.amountOut = '';\n      state.toAmount = '';\n      state.routes = [];\n      state.selectedRoute = null;\n    }\n  },\n\n  setAmountOut(amount: string) {\n    state.amountOut = amount;\n    state.toAmount = amount; // Keep aliases synchronized\n  },\n\n  // Backward compatibility aliases\n  setFromAmount(amount: string) {\n    actions.setAmountIn(amount);\n  },\n\n  setToAmount(amount: string) {\n    actions.setAmountOut(amount);\n  },\n\n  setRoutes(routes: RoutePath[]) {\n    state.routes = [...routes];\n    state.loading = false;\n    state.error = null;\n\n    // Auto-select best route (first one, assumed to be optimal)\n    if (routes.length > 0) {\n      actions.setSelectedRoute(routes[0]);\n    }\n  },\n\n  setSelectedRoute(route: RoutePath | null) {\n    state.selectedRoute = route;\n\n    // Calculate expected output from route\n    if (route && route.path.length > 0) {\n      const lastHop = route.path[route.path.length - 1];\n      state.amountOut = lastHop.amount_out;\n    }\n  },\n\n  setLoading(loading: boolean) {\n    state.loading = loading;\n  },\n\n  setError(error: string | null) {\n    state.error = error;\n  },\n\n  setSlippage(slippage: number) {\n    state.slippage = slippage;\n  },\n\n  // Additional methods that components expect\n  setLoadingRoutes(loading: boolean) {\n    state.loading = loading;\n  },\n\n  setSwapping(swapping: boolean) {\n    state.loading = swapping; // Use loading flag for swapping state\n  },\n\n  swapTokens() {\n    const tokenIn = state.tokenIn;\n    const tokenOut = state.tokenOut;\n    const amountIn = state.amountIn;\n\n    state.tokenIn = tokenOut;\n    state.tokenOut = tokenIn;\n    state.fromToken = tokenOut; // Keep aliases synchronized\n    state.toToken = tokenIn;\n    state.amountIn = '';\n    state.amountOut = amountIn;\n    state.fromAmount = '';\n    state.toAmount = amountIn;\n    state.routes = [];\n    state.selectedRoute = null;\n    state.error = null;\n  },\n\n  clear() {\n    reset();\n  },\n};\n\n// Getters\nconst getters = {\n  canSwap: () => {\n    return !!(\n      state.tokenIn &&\n      state.tokenOut &&\n      state.amountIn &&\n      parseFloat(state.amountIn) > 0 &&\n      state.selectedRoute &&\n      !state.loading\n    );\n  },\n\n  getPriceImpact: () => {\n    return state.selectedRoute?.total_price_impact || '0';\n  },\n\n  getEstimatedGas: () => {\n    // This would be calculated based on the route complexity\n    if (!state.selectedRoute) return '0';\n\n    const hopCount = state.selectedRoute.path.length;\n    return (hopCount * 100000).toString(); // Rough estimate\n  },\n\n  isValidPair: () => {\n    return !!(\n      state.tokenIn &&\n      state.tokenOut &&\n      state.tokenIn.id !== state.tokenOut.id\n    );\n  },\n\n  getSlippageAmount: () => {\n    if (!state.amountOut || !state.slippage) return '0';\n\n    try {\n      const output = BigInt(state.amountOut);\n      const slippageBps = BigInt(Math.floor(state.slippage * 100)); // Convert to basis points\n      const slippageAmount = (output * slippageBps) / BigInt(10000);\n      const minimumReceive = output - slippageAmount;\n\n      return minimumReceive.toString();\n    } catch {\n      return '0';\n    }\n  },\n};\n\n// Proper store type definition extending BaseStore\nexport interface SwapStore extends BaseStore<SwapState> {\n  setTokenIn: (token: TokenMetadata | null) => void;\n  setTokenOut: (token: TokenMetadata | null) => void;\n  setFromToken: (token: TokenMetadata | null) => void; // alias\n  setToToken: (token: TokenMetadata | null) => void;   // alias\n  setAmountIn: (amount: string) => void;\n  setAmountOut: (amount: string) => void;\n  setFromAmount: (amount: string) => void; // alias\n  setToAmount: (amount: string) => void;   // alias\n  setRoutes: (routes: RoutePath[]) => void;\n  setSelectedRoute: (route: RoutePath | null) => void;\n  setLoading: (loading: boolean) => void;\n  setLoadingRoutes: (loading: boolean) => void; // alias\n  setSwapping: (swapping: boolean) => void; // alias\n  setError: (error: string | null) => void;\n  setSlippage: (slippage: number) => void;\n  swapTokens: () => void;\n  clear: () => void;\n  canSwap: () => boolean;\n  getPriceImpact: () => string;\n  getEstimatedGas: () => string;\n  isValidPair: () => boolean;\n  getSlippageAmount: () => string;\n}\n\nexport const swapStore: SwapStore = {\n  state,\n  onChange,\n  reset,\n  dispose,\n  ...actions,\n  ...getters,\n};\n\nexport type { SwapState };\n"],"names":[],"mappings":"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"}